* move FSA to individual lib

* refactor internals

* write tests